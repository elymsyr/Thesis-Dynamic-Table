<!DOCTYPE html>
<html>
  <head>
    <title>b081_1</title>
    <link href="..\style.css" rel="stylesheet">
  </head>
  <body>
    <div class="top-left">
      <a onclick="scrollToTop()">Go to Top</a>
      <a onclick="shrunk()">Shrunk</a>
      <a onclick="readCurrentHTMLFileAndSave()">Save</a>
      <a href="../index.html" id="header">Back to Versions</a>
    </div><br><br><br>
    <h1>
      <a class="content-header" onclick="toggleAccordion(this, 1)">b081_1</a>
    </h1>
    <div class="accordion-content">
      <ol>
        <li>
          <a href="#notes" id="OLnotes">Notes</a>
        </li>
        <li id="OLreward">
          <a href="#reward">Reward</a>
        </li>
        <li id="OLhowworks">
          <a href="#howworks">How Works</a>
        </li>
        <li id="OLgraphs">
          <a href="#graphs">Graphs</a>
        </li>
      </ol>
    </div>
    <b class="content-header" onclick="toggleAccordion(this, 2)">
      <h2>
        <a id="notes">Notes</a>
      </h2>
    </b>
    <div class="accordion-content" id="textnotes">
      <textarea cols="50" id="textAreaNotes" placeholder="Type or insert text here..." rows="5"></textarea>
      <button onclick="createParagraph('textnotes', 'textAreaNotes')">Insert Text</button>
    </div>
    <b>
      <h2 id="reward">
        <a class="content-header" onclick="toggleAccordion(this, 3)">Principle &amp; Reward</a>
      </h2>
    </b>
    <div class="accordion-content" id="textreward">
      <textarea cols="50" id="textAreaReward" placeholder="Type or insert text here..." rows="5"></textarea>
      <button onclick="createParagraph('textreward', 'textAreaReward')">Insert Text</button>
    </div>
    <b>
      <h2 id="howworks">
        <a class="content-header" onclick="toggleAccordion(this, 4)">How Works</a>
      </h2>
    </b>
    <div class="accordion-content">
      <div>
        <ul>
          <li style="display:flex;justify-content: flex-start;">
            <a href="..\..\Versions\b081_1\Files\Scripts\configuration.yaml" target="_blank">configuration.yaml</a>
            <p class="underline" onclick="toggleAccordion(this, 5)" style="margin:0px 10px;color:#919191;">show code</p>
          </li>
          <textarea class="accordion-content" cols="120" readonly="readonly" rows="20">default_settings: null
behaviors:
  Dynamic Table:
    trainer_type: ppo
    hyperparameters:
      batch_size: 1024
      buffer_size: 10240
      learning_rate: 0.0008
      beta: 0.005
      epsilon: 0.2
      lambd: 0.95
      num_epoch: 3
      shared_critic: false
      learning_rate_schedule: linear
      beta_schedule: linear
      epsilon_schedule: linear
    checkpoint_interval: 800000
    network_settings:
      normalize: false
      hidden_units: 64
      num_layers: 3
      vis_encode_type: simple
      memory: null
      goal_conditioning_type: hyper
      deterministic: false
    reward_signals:
      extrinsic:
        gamma: 0.99
        strength: 1.0
        network_settings:
          normalize: false
          hidden_units: 64
          num_layers: 3
          vis_encode_type: simple
          memory: null
          goal_conditioning_type: hyper
          deterministic: false
    init_path: null
    keep_checkpoints: 15
    even_checkpoints: false
    max_steps: 8000000
    time_horizon: 64
    summary_freq: 10000
    threaded: false
    self_play: null
    behavioral_cloning: null
env_settings:
  env_path: /content/drive/MyDrive/builds/b081_1/build.x86_64
  env_args: null
  base_port: 5004
  num_envs: 5
  num_areas: 1
  timeout_wait: 60
  seed: -1
  max_lifetime_restarts: 10
  restarts_rate_limit_n: 1
  restarts_rate_limit_period_s: 60
engine_settings:
  width: 84
  height: 84
  quality_level: 5
  time_scale: 20.0
  target_frame_rate: -1
  capture_frame_rate: 60
  no_graphics: true
environment_parameters: null
checkpoint_settings:
  run_id: b081_1
  initialize_from: null
  load_model: false
  resume: false
  force: false
  train_model: false
  inference: false
  results_dir: /content/drive/MyDrive/results
torch_settings:
  device: cuda
debug: false
</textarea>
          <li style="display:flex;justify-content: flex-start;">
            <a href="..\..\Versions\b081_1\Files\Scripts\CreateBoard.cs" target="_blank">CreateBoard.cs</a>
            <p class="underline" onclick="toggleAccordion(this, 6)" style="margin:0px 10px;color:#919191;">show code</p>
          </li>
          <textarea class="accordion-content" cols="120" readonly="readonly" rows="20">using System.Collections.Generic;
using UnityEngine;

public class CreateBoard08 : MonoBehaviour
{
    public Material mazeMaterial;
    public float[] wallBorders;
    private List&lt;GameObject&gt; maze;
    public int wallNumber = 0;
    public int getWallNumber =&gt; wallNumber;
    private bool mazeCreated = false;

    public void CreateMaze()
    {
        int wallNumberStart = 0;
        wallNumber = 0;
        int LayerIgnoreRaycast = LayerMask.NameToLayer(&quot;Walls&quot;);
        for (float x = wallBorders[1]-10.1f; x &lt;= wallBorders[0]+0.1f; x += 10f)
        {
            for (float z = wallBorders[3]-10.1f; z &lt;= wallBorders[2]+0.1f; z += 10f)
            {
                wallNumberStart++;
            }
        }
        maze = new List&lt;GameObject&gt;(wallNumberStart);
        for (float x = wallBorders[1]-10.1f; x &lt;= wallBorders[0]+0.1f; x += 10f)
        {
            for (float z = wallBorders[3]-10.1f; z &lt;= wallBorders[2]+0.1f; z += 10f)
            {
                GameObject wall = GameObject.CreatePrimitive(PrimitiveType.Cube);
                wall.layer = LayerIgnoreRaycast;
                wall.tag = &quot;Wall&quot;;
                wall.transform.parent = transform;
                wall.transform.localPosition = new Vector3(0, -11f, 0);
                wall.transform.localScale = new Vector3(0.5f,15f,5f);
                BoxCollider collider = wall.GetComponent&lt;BoxCollider&gt;();
                collider.isTrigger = true;
                if (mazeMaterial != null)
                {
                    Renderer renderer = wall.GetComponent&lt;Renderer&gt;();
                    if (renderer != null)
                    {
                        renderer.material = mazeMaterial;
                    }
                }
                maze.Add(wall);
            }
        }
    }

    public void ResetWalls(){
        if(mazeCreated){CreateMaze();}
        wallNumber = 0;
        foreach(GameObject wall in maze)
        {
            wall.transform.localPosition = new Vector3(0f, -11f, 0f);
        }        
    }

    public void SetMaze(float dif){
        if(mazeCreated){CreateMaze();}
        ResetWalls();
        wallNumber = 0;
        int wall_index = -1;
        float slide = Random.Range(7.5f, 12.5f);
        for (float x = wallBorders[1]-10.1f; x &lt;= wallBorders[0]+0.1f; x += 10f)
        {
            for (float z = wallBorders[3]-10.1f; z &lt;= wallBorders[2]+0.1f; z += 10f)
            {
                if (Random.Range(0f, 1f) &lt; dif)
                {
                    if(wall_index++ &lt; maze.Count &amp;&amp; maze[wall_index] != null){
                        wallNumber++;
                        maze[wall_index].transform.localRotation = Quaternion.Euler(0f,Random.Range(0f, 360f),0f);
                        maze[wall_index].transform.localPosition = new Vector3(x+slide, 8f, z+slide);
                    }
                }
            }
        } 
    }
}
</textarea>
          <li style="display:flex;justify-content: flex-start;">
            <a href="..\..\Versions\b081_1\Files\Scripts\dynamicTable.cs" target="_blank">dynamicTable.cs</a>
            <p class="underline" onclick="toggleAccordion(this, 7)" style="margin:0px 10px;color:#919191;">show code</p>
          </li>
          <textarea class="accordion-content" cols="120" readonly="readonly" rows="20">using UnityEngine;
using Unity.MLAgents.Actuators;
using Unity.MLAgents;
using TMPro;
using Unity.MLAgents.Sensors;
using System;
using System.Collections.Generic;
using System.Linq;
using Unity.VisualScripting;

public class dynamicTable08 : Agent
{
    [Header(&quot;UI&quot;)]
    [SerializeField] private bool showUI = false;
    [SerializeField] private GameObject text;
    [Header(&quot;Target Run&quot;)]
    [SerializeField] public bool targetMovement = false;
    [SerializeField] public float getTargetSpeed =&gt; customTargetSpeed;
    [SerializeField] public float customTargetSpeed = 6f;
    [Header(&quot;Maze&quot;)]
    [SerializeField] private bool maze = false;
    [SerializeField] private bool setDifficulty = false;
    [SerializeField] [Range(0f, 0.99f)]private float MazeDifficulty = 0.2f;
    [Header(&quot;Set&quot;)]
    [SerializeField] private GameObject pathfinder;
    [SerializeField] private GameObject product;
    [SerializeField] private GameObject target;
    [Range(0f,15f)] public float MoveSpeed = 12f;
    private int win = 0;
    private int winState = 0;
    private Queue&lt;int&gt; gameStates = new Queue&lt;int&gt;();
    private AStar AStar;
    private int RowsNColumns = 22;
    private float closeness = 0;
    private float scale = 4f; 
    private TextMeshPro ui;
    private float directionPoint = 0;
    private int rows = 22;
    private int columns = 22;
    private Transform[,] boxesArray;
    private Vector3[,] boxesLoc;
    private float[] wallBorders = {14.2f,-15.2f,14.2f,-15.2f};
    public float[] getBorders =&gt; wallBorders;
    private int size = 8;
    private Transform[] activeArray;
    private Rigidbody productRigidbody;
    private List&lt;Tuple&lt;int, int&gt;&gt; specifiedPoints = new List&lt;Tuple&lt;int, int&gt;&gt;(){new Tuple&lt;int, int&gt;(0, 0),new Tuple&lt;int, int&gt;(0, 1),new Tuple&lt;int, int&gt;(1, 0),new Tuple&lt;int, int&gt;(2, 0),new Tuple&lt;int, int&gt;(0, 2),new Tuple&lt;int, int&gt;(0, 5),new Tuple&lt;int, int&gt;(0, 6),new Tuple&lt;int, int&gt;(0, 7),new Tuple&lt;int, int&gt;(1, 7),new Tuple&lt;int, int&gt;(2, 7),new Tuple&lt;int, int&gt;(5, 0),new Tuple&lt;int, int&gt;(6, 0),new Tuple&lt;int, int&gt;(7, 0),new Tuple&lt;int, int&gt;(7, 1),new Tuple&lt;int, int&gt;(7, 2),new Tuple&lt;int, int&gt;(7, 5),new Tuple&lt;int, int&gt;(7, 6),new Tuple&lt;int, int&gt;(7, 7),new Tuple&lt;int, int&gt;(6, 7),new Tuple&lt;int, int&gt;(5, 7),};
    private productCollision08 productClass;
    private StatsRecorder recorder;
    private int lastStep = 0;
    private float heighpoint;
    private CreateBoard08 Labyrynt;

    void Awake()
    {
        AStar = pathfinder.GetComponent&lt;AStar&gt;();
        Labyrynt = transform.GetComponent&lt;CreateBoard08&gt;();
        Labyrynt.wallBorders = wallBorders;
        if(maze){
            Labyrynt.CreateMaze();
        }
        rows = RowsNColumns;
        columns = RowsNColumns;
        productClass = product.GetComponent&lt;productCollision08&gt;(); 
        recorder = Academy.Instance.StatsRecorder;

        if (text != null)
        {
            ui = text.GetComponent&lt;TextMeshPro&gt;();
        }

        productRigidbody = product.GetComponent&lt;Rigidbody&gt;();

        int childIndex = 0;
        int rowIndex = 0;
        int columnIndex = 0;
        boxesArray = new Transform[rows, columns];
        boxesLoc = new Vector3[rows, columns];
        Transform pieces = transform.Find(&quot;Pieces&quot;);
        for (int i = 0; i &lt; rows*columns; i++)
        {
            Transform child = pieces.GetChild(childIndex);
            boxesArray[rowIndex, columnIndex] = child;
            boxesLoc[rowIndex, columnIndex] = child.localPosition;
            columnIndex++;
            if (columnIndex &gt;= columns)
            {
                columnIndex = 0;
                rowIndex++;
            }
            childIndex++;
        }
    }

    public override void OnActionReceived(ActionBuffers actions)
    {
        if(product.transform.localPosition.y &lt; 0){EndEpisode();}
        int index = 0;
        int movingPartsIndex = 0;
        GetActiveArray();

        foreach (Transform child in boxesArray)
        {
            if (child != null)
            {
                if (Array.IndexOf(activeArray, child) != -1){
                    float newYPosition = child.localPosition.y + actions.ContinuousActions[movingPartsIndex] * MoveSpeed * Time.deltaTime;
                    newYPosition = Mathf.Clamp(newYPosition, 0f, 4.7f);
                    child.localPosition = new Vector3(child.localPosition.x, newYPosition, child.localPosition.z);
                    movingPartsIndex++;
                }
                else
                {
                    int i = index / rows;
                    int j = index % columns;
                    child.transform.localPosition = boxesLoc[i, j];
                }
                index++;
            }
            else{
                Debug.Log(&quot;Null child founded!&quot;);
            }
        }

        if (!productClass.triggered){
            if(maze &amp;&amp; AStar.getPath != null &amp;&amp; AStar.getPath.Count &gt; 0){
                directionPoint = Vector3.Dot(productRigidbody.velocity.normalized, (new Vector3(AStar.getPath[0].transform.localPosition.x, 0f, AStar.getPath[0].transform.localPosition.z) - new Vector3(product.transform.localPosition.x, 0f, product.transform.localPosition.z)).normalized);
            }
            else{
                directionPoint = Vector3.Dot(productRigidbody.velocity.normalized, (new Vector3(target.transform.localPosition.x, 0f, target.transform.localPosition.z) - new Vector3(product.transform.localPosition.x, 0f, product.transform.localPosition.z)).normalized);
            }
            closeness = shrunk(targetCloseness(), min:0.001f, max:30, newMin:1, newMax:10);
            heighpoint = Math.Abs(product.transform.localPosition.y - 6.1f);
            if(heighpoint&lt;0.1f){heighpoint=0.1f;}
            float speed = productRigidbody.velocity.magnitude;
            if(directionPoint&lt;0.5f &amp;&amp; directionPoint&gt;0){directionPoint*=-1;}
            if(speed &lt; 0.1f){speed = 0.1f;}
            float reward = ((directionPoint*speed*speed)-heighpoint)/closeness;
            AddReward(shrunk(reward, reward_state:true));
        }

        // if(!productClass.triggered){
        //     directionPoint = Vector3.Dot(productRigidbody.velocity.normalized, (target.transform.localPosition - product.transform.localPosition).normalized);
        //     float heightPoint = product.transform.localPosition.y;
        //     float closeness = targetCloseness();
        //     float speed = productRigidbody.velocity.magnitude;
        //     if(directionPoint&lt;0.6f &amp;&amp; directionPoint&gt;0 &amp;&amp; !maze){directionPoint*=-1;}
        //     if(speed &lt; 0.1f){speed = 0.1f;}
        //     if(closeness&lt;0.1){closeness = 0.1f;}
        //     float reward_increase = directionPoint * speed * speed * 0.0001f;
        //     float reward_decrease = (float)Math.Pow(closeness, 0.1f);
        //     float reward = reward_increase / reward_decrease;
        //     if(directionPoint&gt;=0){
        //         reward += heightPoint*0.0001f*0.3f;
        //     }
        //     AddReward(reward);            
        // }
        
        if (showUI)
        {
            updateUI();
        }
        lastStep = StepCount;
    }

    private float shrunk(float reward, float min = -100 , float max = 100, float newMin = -0.1f, float newMax = 0.1f, bool reward_state = false){
        if(reward_state==true){
            if(reward&gt;0){newMin=0; min = 0;}
            if(reward&lt;0){newMax=0; max = 0;}
        }
        return newMin + ((newMax-newMin)*(reward-min)/(max-min));
    }    
    
    public override void OnEpisodeBegin()
    {
        if(!setDifficulty){
            if(MazeDifficulty &gt; 0.75f){MazeDifficulty = 0.75f;}
            else if(MazeDifficulty &lt; 0.1f){MazeDifficulty = 0.1f;}
        }
        MaxStep = (int)(250f+ MazeDifficulty*100);
        if(maze &amp;&amp; (UnityEngine.Random.Range(71f,90f)-MazeDifficulty*100)%CompletedEpisodes &lt; 3){
            Labyrynt.SetMaze(MazeDifficulty);
        }
        gameStates.Enqueue(winState);
        if(gameStates.Count &gt; 500){
            gameStates.Dequeue();
        }
        winState = 0;
        recorder.Add(&quot;Custom/Win Percentage of Last 500 Episodes&quot;,CalculatePercentageOfOnes(),StatAggregationMethod.Average);
        recorder.Add(&quot;Custom/Completed Episodes&quot;,CompletedEpisodes,StatAggregationMethod.Average);
        recorder.Add(&quot;Custom/Avg Step&quot;,lastStep,StatAggregationMethod.Average);
        recorder.Add(&quot;Custom/Maz Step&quot;,MaxStep,StatAggregationMethod.Average);
        if(maze){
            recorder.Add(&quot;Custom/Maze Difficulty&quot;,MazeDifficulty,StatAggregationMethod.Average);
            recorder.Add(&quot;Custom/Number of Walls&quot;,Labyrynt.wallNumber,StatAggregationMethod.Average);
        }
        product.transform.localRotation = Quaternion.Euler(0f, 0f, 0f);
        productRigidbody.velocity = Vector3.zero;
        activeArray = new Transform[size*size-specifiedPoints.Count];
        ObjectPos();
    }

    private float CalculatePercentageOfOnes()
    {   if(gameStates.Count &gt; 0){
            int totalOnes = 0;
            foreach (int item in gameStates)
            {
                if (item == 1)
                {
                    totalOnes++;
                }
            }
            return ((float)totalOnes / gameStates.Count) * 100f;
        }
        else{return 0;}
    }     

    public void triggerReset(){
        if(!setDifficulty){MazeDifficulty -= 0.075f;}
        AddReward(-0.5f); //changed
        EndEpisode();
    }
    
    public void winReset(){
        win++;
        if(!setDifficulty){MazeDifficulty += 0.07f;}
        winState = 1;
        AddReward(2f);
        EndEpisode();
    }

    public override void CollectObservations(VectorSensor sensor)
    {
        foreach (Transform child in activeArray)
        {
            if (child != null)
            {
                sensor.AddObservation(child.localPosition.y);
            }
            else
            {
                sensor.AddObservation(0);
            }
        }
        sensor.AddObservation(product.transform.localPosition);
        if(!maze){
            sensor.AddObservation(target.transform.localPosition);
        }
        else{
            if(AStar.getPath != null &amp;&amp; AStar.getPath.Count &gt; 0){
                sensor.AddObservation(gameObject.transform.InverseTransformPoint(AStar.getPath[0].position));
                }
            else{sensor.AddObservation(target.transform.localPosition);}
        }

        sensor.AddObservation(targetCloseness());
        sensor.AddObservation(productRigidbody.velocity.magnitude);
    }

    private Vector3 randomPos(){
        return new Vector3(UnityEngine.Random.Range(wallBorders[0]-scale, wallBorders[1]+scale), UnityEngine.Random.Range(6f,7f), UnityEngine.Random.Range(wallBorders[2]-scale, wallBorders[3]+scale));
    }     

    public void ObjectPos(){
        Vector3 target_start;
        Vector3 product_start;
        do{
            target_start = randomPos();
            product_start = randomPos();
        }while(Vector3.Distance(target_start, product_start) &lt; 25f);
        target.transform.localPosition = target_start;
        product.transform.localPosition = product_start;
    }


    public override void Heuristic(in ActionBuffers actionsOut)
    {
        ActionSegment&lt;float&gt; continuousActions = actionsOut.ContinuousActions;
        for (int i = 0; i &lt; size*size-specifiedPoints.Count; i++)
        {
            continuousActions[i] = UnityEngine.Random.Range(-1f, 1f);
        }       
    }

    private void updateUI()
    {
        ui.text = &quot;Product States\nAre we winning? &quot;+CalculatePercentageOfOnes()+&quot;\nBoard Size: &quot;+rows+&quot;x&quot;+columns+&quot;\nDirection: &quot;+directionPoint+&quot;\nSpeed: &quot;+productRigidbody.velocity.magnitude+&quot;\nPosition: &quot;+product.transform.localPosition+&quot;\nHeighpoint: &quot;+heighpoint+&quot;\nDistance to Target: &quot;+closeness+&quot;\nReward: &quot;+GetCumulativeReward()+&quot;\nAction Count: &quot;+StepCount+&quot;\nGame Count: &quot;+CompletedEpisodes+&quot;\nWin Count: &quot;+win+&quot;\nActive Parts Map: \n&quot;+ActiveMap();
    }

    private string ActiveMap(){
        string arrayString = &quot;&quot;;
        int index = 0;
        int[] alpha = new int[specifiedPoints.Count];
        for(int i=0;i&lt;specifiedPoints.Count;i++){
            alpha[i] = specifiedPoints[i].Item1*size+specifiedPoints[i].Item2;
        }
        for (int i = 0; i &lt; size*size; i++)
        {
            if (alpha.Contains(i)){arrayString += &quot; _ &quot;;}
            else{
                if (activeArray[index] != null){arrayString += (int)activeArray[index].transform.localPosition.y+&quot; &quot;;}
                else{arrayString += &quot;X &quot;;}
                index++;
            }
            if ((i+1)%size == 0){arrayString += &quot;\n&quot;;}
        }
        return arrayString;       
    }

    private void GetActiveArray()
    {
        int[] centerPoint = FindClosestTransform();
        bool isInList;
        int startX = centerPoint[0] - size / 2;
        int startY = centerPoint[1] - size / 2;
        int index = 0;
        for (int i = 0; i &lt; size; i++)
        {
            for (int j = 0; j &lt; size; j++)
            {
                isInList = specifiedPoints.Any(tuple =&gt; tuple.Item1 == (i,j).Item1 &amp;&amp; tuple.Item2 == (i,j).Item2);
                if (!isInList){
                    if(IsIndexValid(startX + i, startY + j) &amp;&amp; boxesArray[startX + i, startY + j] != null){
                        activeArray[index] = boxesArray[startX + i, startY + j];
                    }
                    else{
                        activeArray[index] = null;
                    }                    
                index++;
                }
            }
        }
    }
    
    private bool IsIndexValid(int rowIndex, int colIndex)
    {
        return rowIndex &gt;= 0 &amp;&amp; rowIndex &lt; rows &amp;&amp; colIndex &gt;= 0 &amp;&amp; colIndex &lt; columns;
    }    
    
    private int[] FindClosestTransform()
    {
        int[] closestPosition = new int[2];
        float closestDistance = Mathf.Infinity;

        for (int i = 0; i &lt; rows; i++)
        {
            for (int j = 0; j &lt; columns; j++)
            {
                Transform transform = boxesArray[i, j];
                if (transform != null)
                {
                    float distance = GetDistanceToChild(transform);
                    if (distance &lt; closestDistance)
                    {
                        closestDistance = distance;
                        closestPosition[0] = i;
                        closestPosition[1] = j;
                    }
                }
            }
        }

        return closestPosition;
    }
    
    private float targetCloseness()
    {
        return Vector3.Distance(product.transform.localPosition, target.transform.localPosition);
    }
    
    private float GetDistanceToChild(Transform child)
    {
        float distance = Vector3.Distance(gameObject.transform.InverseTransformPoint(new Vector3(child.position.x, 0f, child.position.z)), gameObject.transform.InverseTransformPoint(new Vector3(product.transform.position.x, 0f, product.transform.position.z)));
        return distance;
    }

}</textarea>
          <li style="display:flex;justify-content: flex-start;">
            <a href="..\..\Versions\b081_1\Files\Scripts\Node.cs" target="_blank">Node.cs</a>
            <p class="underline" onclick="toggleAccordion(this, 8)" style="margin:0px 10px;color:#919191;">show code</p>
          </li>
          <textarea class="accordion-content" cols="120" readonly="readonly" rows="20">using System.Collections.Generic;
using UnityEngine;

public class Node : MonoBehaviour
{
    public float gCost = 999999f;
    public float hCost = 999999f;
    public bool wallFlag = false;
    public float exposure = 2.5f;
    public LayerMask layerMask;
    public float fCost =&gt; gCost + hCost;
    public List&lt;Transform&gt; neighbors;
    public Transform parent;

    public void CheckCollide(){
        Vector3[] directions = {
            // Cardinal directions along XZ plane
            Vector3.forward,
            Vector3.back,
            Vector3.left,
            Vector3.right,
            // Diagonal directions along XZ plane
            new Vector3(1, 0, 1).normalized,
            new Vector3(-1, 0, 1).normalized,
            new Vector3(1, 0, -1).normalized,
            new Vector3(-1, 0, -1).normalized,
            // Secondary directions along XZ plane
            Quaternion.Euler(0, 45, 0) * Vector3.forward,
            Quaternion.Euler(0, 45, 0) * Vector3.back,
            Quaternion.Euler(0, 45, 0) * Vector3.left,
            Quaternion.Euler(0, 45, 0) * Vector3.right,
            // Secondary diagonal directions along XZ plane
            Quaternion.Euler(0, 45, 0) * new Vector3(1, 0, 1).normalized,
            Quaternion.Euler(0, 45, 0) * new Vector3(-1, 0, 1).normalized,
            Quaternion.Euler(0, 45, 0) * new Vector3(1, 0, -1).normalized,
            Quaternion.Euler(0, 45, 0) * new Vector3(-1, 0, -1).normalized,
        };
        foreach (Vector3 direction in directions)
        {
            RaycastHit hit;
            if (Physics.Raycast(transform.position, direction, out hit, exposure, layerMask))
            {
                wallFlag = true;
                break;
            }
        }
    }

    public void resetNode(Transform target){
        wallFlag = false;
        CheckCollide();
        if(!wallFlag){
            hCost = Vector3.Distance(transform.localPosition, target.localPosition);
        }
        else{hCost = 999999f;}
        gCost = 999999f;
        parent = null;
    }

    public void initializeNeighbors(List&lt;Transform&gt; newNeighbors){
        neighbors = newNeighbors;
    }

    public float setgCost(Transform neighbor){
        gCost = Vector3.Distance(transform.localPosition, neighbor.localPosition);
        return Vector3.Distance(transform.localPosition, neighbor.localPosition);
    }

}
</textarea>
          <li style="display:flex;justify-content: flex-start;">
            <a href="..\..\Versions\b081_1\Files\Scripts\PathFinder.cs" target="_blank">PathFinder.cs</a>
            <p class="underline" onclick="toggleAccordion(this, 9)" style="margin:0px 10px;color:#919191;">show code</p>
          </li>
          <textarea class="accordion-content" cols="120" readonly="readonly" rows="20">using System.Collections.Generic;
using UnityEngine;

public class AStar : MonoBehaviour
{
    public Material selectedRoad;
    public Material pathObjects;
    public Material wallDetected;
    public float mean = 26;
    public float scale = 0.1f;
    private int rowColumns =&gt; (int)(mean/scale);
    public GameObject cellPrefab;
    public Transform[,] nodes;
    public Transform product;
    public Transform target;
    private Vector3 lastPos = new Vector3(0f,0f,0f);
    public bool pathFinder = true;
    private List&lt;Transform&gt; path;
    public List&lt;Transform&gt; getPath =&gt; path;

    void Start()
    {
        path = new List&lt;Transform&gt;();
        if(pathFinder){initPathFinder();}
    }

    public void initPathFinder(){
        nodes = new Transform[rowColumns, rowColumns];
        createPathObjects();
        initializeNeighborsAll();
    }

    private void Update(){
        if(pathFinder &amp;&amp; Vector3.Distance(lastPos,product.localPosition)&gt;1.5f){ 
            lastPos = product.localPosition;
            PathFinder(getPoint(product), getPoint(target));
        }
    }

    public void PathFinder(Transform startnode, Transform targetNode){
        resetNodeAll(targetNode);
        List&lt;Transform&gt; first_path = new List&lt;Transform&gt;();
        first_path = FindPath(startnode, targetNode);
        if (first_path != null &amp;&amp; first_path.Count &gt; 0)
        {
            path.Clear();
            for(int i = 12;i&lt;first_path.Count-8;i++){
                if(i%4 == 0){
                    path.Add(first_path[i]);
                }
            }
            colorRoad(path);
        }
        else
        {
            Debug.Log(&quot;No path found.&quot;);
        }
        
    }

    public void colorRoad(List&lt;Transform&gt; path){
        foreach(Transform node in nodes){
            if(path.Contains(node)){changeMaterial(node, selectedRoad);}
        }
    }

    public void changeMaterial(Transform node, Material selected){
        Renderer renderer = node.GetComponent&lt;Renderer&gt;();
        if (renderer != null)
        {
            renderer.material = selected;
        }
    }

    private void createPathObjects(){
        // for (int x = 0; x &lt; rowColumns; x++)
        // {
        //     for (int y = 0; y &lt; rowColumns; y++)
        //     {
        //         Vector3 cellPosition = new Vector3(x*scale, 0, y*scale);
        //         GameObject cellObject = Instantiate(cellPrefab, cellPosition, Quaternion.identity);
        //         cellObject.transform.parent = transform;
        //         nodes[x, y] = cellObject.transform;
        //     }
        // }
        // transform.localPosition = new Vector3(150.339996f,-27.4599991f,35.8800011f);
        for (int x = 0; x &lt; rowColumns; x++)
        {
            for (int y = 0; y &lt; rowColumns; y++)
            {
                nodes[x, y] = transform.GetChild(x * rowColumns + y);
            }
        }
    }

    private List&lt;Transform&gt; GetSurroundingTransforms(int x, int y)
    {
        List&lt;Transform&gt; surroundingTransforms = new List&lt;Transform&gt;();
        int[] offsetX = { -1,  0,  1, -1, 1, -1, 0, 1 };
        int[] offsetY = { -1, -1, -1,  0, 0,  1, 1, 1 };
        for (int i = 0; i &lt; offsetX.Length; i++)
        {
            int newX = x + offsetX[i];
            int newY = y + offsetY[i];

            if (newX &gt;= 0 &amp;&amp; newX &lt; rowColumns &amp;&amp; newY &gt;= 0 &amp;&amp; newY &lt; rowColumns)
            {
                surroundingTransforms.Add(nodes[newX, newY]);
            }
        }

        return surroundingTransforms;
    }

    private void initializeNeighborsAll(){
        for (int x = 0; x &lt; rowColumns; x++)
        {
            for (int y = 0; y &lt; rowColumns; y++)
            {
                nodes[x,y].GetComponent&lt;Node&gt;().initializeNeighbors(GetSurroundingTransforms(x,y));
            }
        }
    }

    private void resetNodeAll(Transform startNode){
        for (int x = 0; x &lt; rowColumns; x++)
        {
            for (int y = 0; y &lt; rowColumns; y++)
            {
                nodes[x,y].GetComponent&lt;Node&gt;().resetNode(startNode);
                changeMaterial(nodes[x,y], pathObjects);
            }
        }
    }

    private List&lt;Transform&gt; FindPath(Transform start, Transform goal)
    {
        List&lt;Transform&gt; openSet = new List&lt;Transform&gt;();
        HashSet&lt;Transform&gt; closedSet = new HashSet&lt;Transform&gt;();
        openSet.Add(start);
        foreach(Transform node in nodes){
            if(node.GetComponent&lt;Node&gt;().wallFlag){
                closedSet.Add(node);
                changeMaterial(node, wallDetected);
            }
        }

        while (openSet.Count &gt; 0)
        {
            Transform currentNode = openSet[0];
            for (int i = 1; i &lt; openSet.Count; i++)
            {
                if (openSet[i].GetComponent&lt;Node&gt;().fCost &lt; currentNode.GetComponent&lt;Node&gt;().fCost || (openSet[i].GetComponent&lt;Node&gt;().fCost == currentNode.GetComponent&lt;Node&gt;().fCost &amp;&amp; openSet[i].GetComponent&lt;Node&gt;().hCost &lt; currentNode.GetComponent&lt;Node&gt;().hCost))
                {
                    currentNode = openSet[i];
                }
            }

            openSet.Remove(currentNode);
            closedSet.Add(currentNode);

            if (currentNode == goal)
            {
                return RetracePath(start, goal);
            }

            foreach (Transform neighbor in currentNode.GetComponent&lt;Node&gt;().neighbors)
            {
                if(neighbor != null){
                    if (closedSet.Contains(neighbor))
                    {
                        continue;
                    }

                    float newMovementCostToNeighbor = currentNode.GetComponent&lt;Node&gt;().setgCost(neighbor) + GetDistance(currentNode, neighbor); 

                    if (newMovementCostToNeighbor &lt; neighbor.GetComponent&lt;Node&gt;().gCost || !openSet.Contains(neighbor))
                    {
                        neighbor.GetComponent&lt;Node&gt;().gCost = newMovementCostToNeighbor;
                        neighbor.GetComponent&lt;Node&gt;().parent = currentNode;

                        if (!openSet.Contains(neighbor))
                        {
                            openSet.Add(neighbor);
                        }
                    }
                }
            }
        }

        return null;
    }

    private List&lt;Transform&gt; RetracePath(Transform startNode, Transform endNode)
    {
        List&lt;Transform&gt; path = new List&lt;Transform&gt;();
        Transform currentNode = endNode;

        while (currentNode != startNode)
        {
            path.Add(currentNode);
            currentNode = currentNode.GetComponent&lt;Node&gt;().parent;
        }
        path.Reverse();
        return path;
    }

    private float GetDistance(Transform nodeA, Transform nodeB)
    {
        return Vector3.Distance(gameObject.transform.InverseTransformPoint(nodeA.position), gameObject.transform.InverseTransformPoint(nodeB.position));
    }  

    private Transform getPoint(Transform point){
        float distance = 1000f;
        Transform pointNode = null;
        foreach(Transform node in nodes){
            if(!node.GetComponent&lt;Node&gt;().wallFlag){
                float newDist = GetDistance(node, point);
                if(newDist&lt;distance){
                    pointNode = node;
                    distance = newDist;
                }
            }
        }
        return pointNode;
    }

}
</textarea>
          <li style="display:flex;justify-content: flex-start;">
            <a href="..\..\Versions\b081_1\Files\Scripts\productCollision.cs" target="_blank">productCollision.cs</a>
            <p class="underline" onclick="toggleAccordion(this, 10)" style="margin:0px 10px;color:#919191;">show code</p>
          </li>
          <textarea class="accordion-content" cols="120" readonly="readonly" rows="20">using System.Collections.Generic;
using System.IO;
using Unity.VisualScripting;
using UnityEngine;

public class productCollision08 : MonoBehaviour
{
    [SerializeField] private GameObject target;
    [SerializeField] private GameObject receiverObject;
    public bool triggered = false;

    private void OnTriggerEnter(Collider other)
    {
        if(other.gameObject == target)
        {
            receiverObject.SendMessage(&quot;winReset&quot;);
            triggered = true;
        }
        if (other.gameObject.CompareTag(&quot;Wall&quot;))
        {
            receiverObject.SendMessage(&quot;triggerReset&quot;);
        }
    }

    private void OnTriggerExit(Collider other){
        if(other.gameObject == target){
            triggered = false;
        }
    }    
}
</textarea>
          <li style="display:flex;justify-content: flex-start;">
            <a href="..\..\Versions\b081_1\Files\Scripts\rayRotation.cs" target="_blank">rayRotation.cs</a>
            <p class="underline" onclick="toggleAccordion(this, 11)" style="margin:0px 10px;color:#919191;">show code</p>
          </li>
          <textarea class="accordion-content" cols="120" readonly="readonly" rows="20">using UnityEngine;

public class rayRotation08 : MonoBehaviour
{

    private Quaternion _initialRotation = Quaternion.Euler(0f,0f,0f);

    
    private void Update(){
        transform.rotation = _initialRotation;
    }

}
</textarea>
          <li style="display:flex;justify-content: flex-start;">
            <a href="..\..\Versions\b081_1\Files\Scripts\readme.txt" target="_blank">readme.txt</a>
            <p class="underline" onclick="toggleAccordion(this, 12)" style="margin:0px 10px;color:#919191;">show code</p>
          </li>
          <textarea class="accordion-content" cols="120" readonly="readonly" rows="20">b081_1 :
    Stage 1
    Maze - Off
    Set Difficulty - Off
    SETTINGS:
        num_envs = 5
        run_id = 'b081_1'
        env = 'b081_1'
        init_from = 'null'
        exe = 'build'
        env_path = f'/content/drive/MyDrive/builds/{env}/{exe}.x86_64'
        hidden_units = 64
        hidden_units_r = 64
        num_layers = 3
        num_layers_r = 3
        rate = 0.0009
        beta = 0.005
        epsilon = 0.2
        lambd = 0.95
        num_epoch = 3
        max_steps = 8000000
        checkpoint_interval = 800000

b081_2 :
    Stage 2
    Maze - On
    Set Difficulty - On
    MazeDifficulty - Minimum
    SETTINGS:
        num_envs = 5
        run_id = 'b081_2'
        env = 'b081_2'
        init_from = 'null' # continue from stage 1

b081_3
    Stage 3
    Set Difficulty - Off
    MazeDifficulty - Minimum
    SETTINGS:
        num_envs = 5
        run_id = 'b081_3'
        env = 'b081_3'
        init_from = 'null' # continue from stage 2

b081_4
    Stage 4
    Set Difficulty - Off
    MazeDifficulty - Avg/High
    SETTINGS:
        num_envs = 5
        run_id = 'b081_4'
        env = 'b081_4'
        init_from = 'null' # continue from stage 3



from jinja2 import Template

# Define the YAML template
yaml_template = &quot;&quot;&quot;
default_settings: null
behaviors:
  Dynamic Table:
    trainer_type: ppo
    hyperparameters:
      batch_size: 1024
      buffer_size: 10240
      learning_rate: {{rate}}
      beta: {{beta}}
      epsilon: {{epsilon}}
      lambd: {{lambd}}
      num_epoch: {{num_epoch}}
      shared_critic: false
      learning_rate_schedule: linear
      beta_schedule: linear
      epsilon_schedule: linear
    checkpoint_interval: {{checkpoint_interval}}
    network_settings:
      normalize: false
      hidden_units: {{hidden_units}}
      num_layers: {{num_layers}}
      vis_encode_type: simple
      memory: null
      goal_conditioning_type: hyper
      deterministic: false
    reward_signals:
      extrinsic:
        gamma: 0.99
        strength: 1.0
        network_settings:
          normalize: false
          hidden_units: {{hidden_units_r}}
          num_layers: {{num_layers_r}}
          vis_encode_type: simple
          memory: null
          goal_conditioning_type: hyper
          deterministic: false
    init_path: {{init_from}}
    keep_checkpoints: 15
    even_checkpoints: false
    max_steps: {{max_steps}}
    time_horizon: 64
    summary_freq: 10000
    threaded: false
    self_play: null
    behavioral_cloning: null
env_settings:
  env_path: {{env_path}}
  env_args: null
  base_port: 5004
  num_envs: {{num_envs}}
  num_areas: 1
  timeout_wait: 60
  seed: -1
  max_lifetime_restarts: 10
  restarts_rate_limit_n: 1
  restarts_rate_limit_period_s: 60
engine_settings:
  width: 84
  height: 84
  quality_level: 5
  time_scale: 20.0
  target_frame_rate: -1
  capture_frame_rate: 60
  no_graphics: true
environment_parameters: null
checkpoint_settings:
  run_id: {{run_id}}
  initialize_from: null
  load_model: false
  resume: false
  force: false
  train_model: false
  inference: false
  results_dir: /content/drive/MyDrive/results
torch_settings:
  device: cuda
debug: false
&quot;&quot;&quot;

# Render the YAML template with variables
yaml_rendered = Template(yaml_template).render(
    run_id=run_id,
    init_from=init_from,
    beta=beta,
    hidden_units_r=hidden_units_r,
    num_layers_r=num_layers_r,
    rate=rate,
    epsilon=epsilon,
    lambd=lambd,
    num_epoch=num_epoch,
    hidden_units=hidden_units,
    num_layers=num_layers,
    env_path=env_path,
    num_envs=num_envs,
    max_steps=max_steps,
    checkpoint_interval=checkpoint_interval
)

# Write the rendered YAML to a file
with open(f&quot;config.yaml&quot;, &quot;w+&quot;) as yaml_file:
    yaml_file.write(yaml_rendered)    </textarea>
          <li style="display:flex;justify-content: flex-start;">
            <a href="..\..\Versions\b081_1\Files\Scripts\TargetMovement.cs" target="_blank">TargetMovement.cs</a>
            <p class="underline" onclick="toggleAccordion(this, 13)" style="margin:0px 10px;color:#919191;">show code</p>
          </li>
          <textarea class="accordion-content" cols="120" readonly="readonly" rows="20">using UnityEngine;
public class TargetMovement08 : MonoBehaviour
{
    private bool isMovementOn = false;
    private dynamicTable08 table;
    private float[] wallBorders = {14.2f,-15.2f,14.2f,-15.2f};
    private float X = 1;
    private float Z = 1;
    [SerializeField] private GameObject product;
    private float distance = 0;
    private bool run;

    private void Awake(){
        table = transform.parent.GetComponent&lt;dynamicTable08&gt;();
        isMovementOn = table.targetMovement;
    }

    void Update()
    {
        if (isMovementOn)
        {
            distance = Vector3.Distance(product.transform.localPosition, transform.localPosition);
            if (Input.anyKey)
            {
                float horizontalInput = Input.GetAxis(&quot;Horizontal&quot;);
                float verticalInput = Input.GetAxis(&quot;Vertical&quot;);
                float newXPosition = transform.localPosition.x + horizontalInput * table.getTargetSpeed * Time.deltaTime;
                newXPosition = Mathf.Clamp(newXPosition, wallBorders[1], wallBorders[0]);                
                float newZPosition = transform.localPosition.z + verticalInput * table.getTargetSpeed * Time.deltaTime;
                newZPosition = Mathf.Clamp(newZPosition, wallBorders[3], wallBorders[2]);
                transform.localPosition = new Vector3(newXPosition, transform.localPosition.y, newZPosition);
            }
            else
            {
                run = true;
                int border = Random.Range(4,15);
                if(border==14){border=9;}
                else if (border&gt;11){border-=5;}
                else if(border&gt;9){border-=4;}
                float horizontalInput = Random.Range(0f, 2f);
                float verticalInput = Random.Range(0f, 2f);
                float newXPosition = transform.localPosition.x + horizontalInput * Random.Range(2f,6f) * Time.deltaTime * X;
                float newZPosition = transform.localPosition.z + verticalInput * Random.Range(2f,6f) * Time.deltaTime * Z;
                if (newXPosition &gt; wallBorders[0] - border) { X = -1 * System.Math.Abs(X); run = false; }
                else if (newXPosition &lt; wallBorders[1] + border) { X = System.Math.Abs(X); run = false; }
                if(newZPosition &gt; wallBorders[2]-border){ Z = -1 * System.Math.Abs(Z); run = false;}
                else if(newZPosition &lt; wallBorders[3]+border){ Z = System.Math.Abs(Z); run = false; }
                transform.localPosition = new Vector3(newXPosition, transform.localPosition.y, newZPosition);
                if ((Vector3.Distance(product.transform.localPosition, transform.localPosition) &lt; distance) &amp;&amp; run){
                    float randomX = Random.Range(0f, 1f);
                    float randomZ = Random.Range(0f, 1f);
                    if (randomX &lt; 0.3f){X = -X;}
                    if (randomZ &lt; 0.3f){Z = -Z;}
                }
            }
        }
    }
}</textarea>
        </ul>
      </div>
    </div>
    <b class="content-header">
      <h2 id="graphs">
        <a>Graphs</a>
      </h2>
    </b>
    <div>
      <h3>Environment:</h3>
      <div style="display: flex;flex-wrap: wrap;gap: .1px;width: 100%;align-items: center;text-align: center;">
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Cumulative Reward</h4>
          <img src="..\..\Versions\b081_1\Environment\CumulativeReward__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Episode Length</h4>
          <img src="..\..\Versions\b081_1\Environment\EpisodeLength__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
      </div>
      <h3>Losses:</h3>
      <div style="display: flex;flex-wrap: wrap;gap: .1px;width: 100%;align-items: center;text-align: center;">
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Policy Loss</h4>
          <img src="..\..\Versions\b081_1\Losses\PolicyLoss__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Value Loss</h4>
          <img src="..\..\Versions\b081_1\Losses\ValueLoss__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
      </div>
      <h3>Policy:</h3>
      <div style="display: flex;flex-wrap: wrap;gap: .1px;width: 100%;align-items: center;text-align: center;">
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Beta</h4>
          <img src="..\..\Versions\b081_1\Policy\Beta__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Entropy</h4>
          <img src="..\..\Versions\b081_1\Policy\Entropy__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Epsilon</h4>
          <img src="..\..\Versions\b081_1\Policy\Epsilon__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Extrinsic Reward</h4>
          <img src="..\..\Versions\b081_1\Policy\ExtrinsicReward__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Extrinsic Value Estimate</h4>
          <img src="..\..\Versions\b081_1\Policy\ExtrinsicValueEstimate__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Learning Rate</h4>
          <img src="..\..\Versions\b081_1\Policy\LearningRate__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
      </div>
      <h3>Custom:</h3>
      <div style="display: flex;flex-wrap: wrap;gap: .1px;width: 100%;align-items: center;text-align: center;">
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Avg Step</h4>
          <img src="..\..\Versions\b081_1\Custom\AvgStep__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
        <div class="tables" style="width: 26%;padding: 0px;">
          <h4 style="margin: 0px 0px 12px 0px;">Completed Episodes</h4>
          <img src="..\..\Versions\b081_1\Custom\CompletedEpisodes__b081_1.png" style="margin: 0;border:0;" width="100%">
        </div>
      </div>
    </div>
    <script src="..\script.js" type="text/javascript"></script>
  </body>
</html>